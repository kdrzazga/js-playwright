<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animated Content Loading</title>
    <style>
		body {
			background-color: white;
		}
        #content {
            border: 0px solid #ccc;
            padding: 20px;
            margin-top: 10px;
        }
		    @font-face {
      font-family: 'c64mono';
      src: url('C64_Pro_Mono-STYLE.ttf') format('truetype');
    }
    tt {
		font-family: c64mono, fixed;
		font-weight: bold;
		font-size: 8px;
		font-color: #aaaaaa;
	}
    </style>
</head>

<body>
<table>
	<tr>
		<td width = "20%"></td>
		<td width = "60%"><div id="content"></div></td>
		<td width = "20%"></td>
	</tr>
</table>

<script>
class AnimatedContentLoader {
    constructor(animParams) {
        this.filesToLoad = animParams['filesToLoad'];
        this.animationSequence = animParams['animationSequence'];
        this.delay = animParams['delay'];
		this.duration = anim1Params['duration'];
        this.fileContents = [];
        this.contentIndex = 0;
		this.intervalPointer = null;

        this.preloadContent();
    }

    preloadContent() {
        const uniqueFiles = [...new Set(this.filesToLoad)]; 
        Promise.all(uniqueFiles.map(file => fetch(file).then(response => response.text())))
        .then(contents => {
            this.fileContents = contents;
			this.startAnimation();
        })
        .catch(error => {
            document.getElementById('content').innerHTML = 'Error loading content.';
        });
    }

    startAnimation() {
        const changeContent = () => {
            document.getElementById('content').innerHTML = this.fileContents[this.animationSequence[this.contentIndex]];
            this.contentIndex = (this.contentIndex + 1) % this.animationSequence.length;
        };

        this.intervalPointer = setInterval(changeContent, this.delay);
    }
	
	stopAnimation(){
		clearInterval(this.intervalPointer);
	}
}

const anim1Params = {
	'filesToLoad': ['k1.html', 'k2.html', 'k3.html', 'k4.html'],
	'animationSequence' : [0, 1, 2, 0, 1, 2, 3],
	'delay' : 110,
	'duration': 5000
};

const anim2Params = {
	'filesToLoad': ['b1.html', 'b2.html'],
	'animationSequence' : [0, 1],
	'delay' : 110,
	'duration': 5000
};

const a1 = new AnimatedContentLoader(anim1Params);

new Promise((resolve) => {
    setTimeout(resolve, a1.duration);
}).then(() => {
    a1.stopAnimation();
    console.log('Animation 1 stopped after 5 seconds');

    new Promise((resolve) => {
		const a2 = new AnimatedContentLoader(anim2Params);
	    setTimeout(resolve, a2.duration);
	}).then(() => {
  	  a2.stopAnimation();
  	  console.log('Animation 2 stopped after 5 seconds');
	});
});

</script>

</body>
</html>
